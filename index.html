<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFE IS GAME</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <style>
        :root {
            --bg-color: #f0f7ff;
            --pastel-blue: #b3e5fc;
            --accent-blue: #4fc3f7;
            --dark-blue: #0288d1;
            --text-main: #37474f;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow-x: hidden;
        }

        /* --- –ë–û–ö–û–í–û–ï –ú–ï–ù–Æ (SIDEBAR) --- */
        .sidebar {
            position: fixed;
            left: -280px;
            top: 0;
            width: 280px;
            height: 100%;
            background: white;
            box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .sidebar.active { left: 0; }

        .menu-btn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 10px rgba(79, 195, 247, 0.3);
        }

        @media (max-width: 768px) {
            .menu-btn { display: block; }
        }

        .main-content {
            padding: 80px 20px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* --- –°–¢–ò–õ–ò –ü–†–û–§–ò–õ–Ø --- */
        .profile-section { text-align: center; }

        .avatar-wrapper {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            cursor: pointer;
        }

        .avatar-wrapper img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--pastel-blue);
            background: #eee;
        }

        .avatar-wrapper:hover::after {
            content: "üì∑";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.3);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .balance-card {
            background: white;
            padding: 25px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.03);
            margin-bottom: 20px;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 12px;
            border: 2px solid var(--bg-color);
            outline: none;
        }

        input:focus { border-color: var(--pastel-blue); }

        .btn-primary { 
            background: var(--accent-blue); 
            color: white; 
            border: none; 
            font-weight: bold; 
            cursor: pointer; 
            padding: 14px;
            border-radius: 12px;
            width: 100%;
        }

        .btn-primary:hover { background: var(--dark-blue); }

        .hidden { display: none; }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(2px);
            z-index: 999;
        }
        .overlay.active { display: block; }

        .remember-wrap {
            display: flex;
            align-items: center;
            font-size: 14px;
            gap: 8px;
            margin-bottom: 10px;
        }
        .remember-wrap input { width: auto; }
    </style>
</head>
<body>

    <button class="menu-btn" onclick="toggleMenu()">‚ò∞ –ü—Ä–æ—Ñ–∏–ª—å</button>
    <div class="overlay" onclick="toggleMenu()"></div>

    <div class="sidebar" id="sidebar">
        <div id="sidebar-profile-content"></div>
    </div>

    <div class="main-content">
        <div id="auth-screen" class="balance-card">
            <h1 style="color: var(--accent-blue);">LIFE IS GAME</h1>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <div class="remember-wrap">
                <input type="checkbox" id="remember">
                <label for="remember">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</label>
            </div>
            <button class="btn-primary" onclick="handleAuth()">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>

        <div id="game-ui" class="hidden">
            <div id="pc-profile-zone" class="balance-card">
                </div>

            <div class="balance-card">
                <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è</h3>
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç! –°–µ–π—á–∞—Å –∏–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º.</p>
                <button class="btn-primary" onclick="addMoney()">–†–∞–±–æ—Ç–∞—Ç—å (+10 ü™ô)</button>
            </div>
        </div>
    </div>

    <input type="file" id="file-input" class="hidden" accept="image/*" onchange="uploadImage(this)">

    <template id="profile-template">
        <div class="profile-section">
            <div class="avatar-wrapper" onclick="triggerFileInput()">
                <img id="user-avatar" src="https://via.placeholder.com/150" alt="Avatar">
            </div>
            <h2 id="display-name" style="margin: 10px 0;">...</h2>
            <div style="font-size: 20px; color: var(--dark-blue); margin-bottom: 15px;">
                <span id="balance">0</span> ü™ô
            </div>
            <input type="text" id="new-name" placeholder="–ù–æ–≤—ã–π –Ω–∏–∫">
            <button class="btn-primary" onclick="updateNickname()">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
            <button onclick="firebase.auth().signOut()" style="margin-top: 15px; color: #ff5252; border: none; background: none; cursor: pointer;">–í—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã</button>
        </div>
    </template>

<script>
    // --- –î–ê–ù–ù–´–ï FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyApdR6xbfV3J2UMWubicsAuwRb3biH9Wnw",
        authDomain: "life-is-game-8f170.firebaseapp.com",
        databaseURL: "https://life-is-game-8f170-default-rtdb.firebaseio.com",
        projectId: "life-is-game-8f170",
        storageBucket: "life-is-game-8f170.firebasestorage.app",
        messagingSenderId: "861554529321",
        appId: "1:861554529321:web:dda30b5d6c879433de7838",
        measurementId: "G-ELFHWJMHBP"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
        document.querySelector('.overlay').classList.toggle('active');
    }

    function adjustProfilePosition() {
        const isMobile = window.innerWidth <= 768;
        const container = isMobile ? document.getElementById('sidebar-profile-content') : document.getElementById('pc-profile-zone');
        
        // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–º–µ–Ω–∏–ª—Å—è —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        if (container.children.length === 0) {
            document.getElementById('sidebar-profile-content').innerHTML = '';
            document.getElementById('pc-profile-zone').innerHTML = '';
            const template = document.getElementById('profile-template').content.cloneNode(true);
            container.appendChild(template);
            if (auth.currentUser) loadUserData(auth.currentUser.uid);
        }
    }

    window.addEventListener('resize', adjustProfilePosition);
    window.addEventListener('load', adjustProfilePosition);

    function handleAuth() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        const remember = document.getElementById('remember').checked;

        const persistence = remember ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION;

        auth.setPersistence(persistence).then(() => {
            return auth.signInWithEmailAndPassword(email, pass).catch(() => {
                return auth.createUserWithEmailAndPassword(email, pass).then(userCred => {
                    db.ref('users/' + userCred.user.uid).set({
                        username: "–ò–≥—Ä–æ–∫",
                        balance: 1000,
                        avatar: "https://cdn-icons-png.flaticon.com/512/149/149071.png"
                    });
                });
            });
        }).catch(e => alert(e.message));
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            loadUserData(user.uid);
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('game-ui').classList.add('hidden');
        }
    });

    function loadUserData(uid) {
        db.ref('users/' + uid).on('value', snap => {
            const data = snap.val();
            if (data) {
                const nameEl = document.getElementById('display-name');
                const balEl = document.getElementById('balance');
                const avEl = document.getElementById('user-avatar');
                if (nameEl) nameEl.innerText = data.username;
                if (balEl) balEl.innerText = data.balance;
                if (avEl) avEl.src = data.avatar;
            }
        });
    }

    function triggerFileInput() { document.getElementById('file-input').click(); }

    async function uploadImage(input) {
        const file = input.files[0];
        if (!file) return;
        const uid = auth.currentUser.uid;
        const storageRef = storage.ref(`avatars/${uid}`);
        
        try {
            const snapshot = await storageRef.put(file);
            const url = await snapshot.ref.getDownloadURL();
            await db.ref('users/' + uid).update({ avatar: url });
        } catch (e) { alert("–û—à–∏–±–∫–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Storage –≤–∫–ª—é—á–µ–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏."); }
    }

    function updateNickname() {
        const name = document.getElementById('new-name').value;
        if (name) db.ref('users/' + auth.currentUser.uid).update({ username: name });
    }

    function addMoney() {
        db.ref('users/' + auth.currentUser.uid + '/balance').transaction(c => (c || 0) + 10);
    }
</script>
</body>
</html>
